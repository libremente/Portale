# -*- encoding : utf-8 -*-
require 'ruby-saml-federa'
require 'apps/portal/lib/auth_provider'
require 'apps/portal/models/auth_providers/federa_emilia_romagna/utente_federa'
require 'apps/portal/models/auth_providers/federa_emilia_romagna/tracciatura_federa_emilia_romagna'
require 'openssl'
require "base64"
require "zlib"

require 'net/http'
require 'uri'

module Portal
    
    class FederaEmiliaRomagna < Spider::PageController
        include HTTPMixin
        include AuthProvider
        include Spider::Messenger::MessengerHelper 
        include Federa::Saml::Coding

        verifica_presenza_configurazioni('federa', ['idp_metadata', 'destination_service_url', 'idp_sso_target_url', 'requester_identificator'])

        auth_provider({
            :label => 'federa_emilia_romagna',
            :nome => 'FedERa/SPID',
            :descrizione => 'Servizio di autenticazione attraverso gestore FedERa o SPID'
        })

        __.xml
        def sp_metadata
            meta = Federa::Saml::Metadata.new
            settings = get_saml_settings
            @response.headers['Content-Type'] = 'application/samlmetadata+xml'
            $out << meta.generate(settings)
        end



        __.action
        def index
            begin
                saml_settings = get_saml_settings
                #create an instance of Federa::Saml::Authrequest
                request = Federa::Saml::Authrequest.new(saml_settings)
                
                auth_request = request.create
                 # Based on the IdP metadata, select the appropriate binding 
                # and return the action to perform to the controller
                meta = Federa::Saml::Metadata.new(saml_settings)
                signature = get_signature(auth_request.uuid,auth_request.request,"http://www.w3.org/2000/09/xmldsig#rsa-sha1")

                

                sso_request = meta.create_sso_request( auth_request.request, {   :RelayState   => request.uuid,
                                                                            :SigAlg       => "http://www.w3.org/2000/09/xmldsig#rsa-sha1",
                                                                            :Signature    => signature
                                                                        } )


                #creo una nuova istanza per la tracciatura
                tracciatura = Portal::TracciaturaFederaEmiliaRomagna.new
                saml_request_dec_compressa = Zlib::Deflate.deflate(auth_request.request)
                tracciatura.authn_request = Base64.strict_encode64(saml_request_dec_compressa)
                tracciatura.authn_req_id = auth_request.uuid
                tracciatura.authn_req_issue_instant = auth_request.issue_instant
                tracciatura.save

                redirect sso_request 

            rescue Exception => exc
                messaggio = "Errore Applicativo ( #{exc.message} )"
                messaggio_log = messaggio
                exc.backtrace.each{|riga_errore| 
                    messaggio_log += "\n\r#{riga_errore}" 
                } 
                Spider.logger.error messaggio_log
                @request.session.flash['errore_auth'] = (Spider.runmode == 'devel' ? messaggio_log.gsub("\n","<br />") : messaggio)
                redirect Portal::ControllerAutenticazione.http_s_url
            end

        end
        
        #url http://localhost:8080/portal/auth/federa_emilia_romagna/assertion_consumer

        __.html
        def assertion_consumer
            target = @request.params['target']
            saml_response = @request.params['SAMLResponse'] 
            #Stringa di response per fare i test
            #saml_response = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c2FtbDJwOlJlc3BvbnNlIHhtbG5zOnNhbWwycD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiBEZXN0aW5hdGlvbj0iaHR0cHM6Ly92YWxsaWRlbGl6aWUuc29sdXppb25pcGEuaXQvcG9ydGFsL2F1dGgvZmVkZXJhX2VtaWxpYV9yb21hZ25hL2Fzc2VydGlvbl9jb25zdW1lciIgSUQ9InMyNDk3NDQ0Y2FkZWMxMzA4MzQ1MTFjODViMjlmZmVhMTFjMjc0ZTMiIEluUmVzcG9uc2VUbz0iXzVkYmU3NWIwLTdhYWYtMDEzNS00MzQzLTAwNTA1NmE1M2QzNCIgSXNzdWVJbnN0YW50PSIyMDE3LTA5LTEzVDEyOjQ1OjUxLjAwN1oiIFZlcnNpb249IjIuMCIgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIj48c2FtbDI6SXNzdWVyIHhtbG5zOnNhbWwyPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj5odHRwczovL2ZlZGVyYS5sZXBpZGEuaXQvZ3cvbWV0YWRhdGE8L3NhbWwyOklzc3Vlcj48ZHM6U2lnbmF0dXJlIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj48ZHM6U2lnbmVkSW5mbz48ZHM6Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPjxkczpTaWduYXR1cmVNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEiLz48ZHM6UmVmZXJlbmNlIFVSST0iI3MyNDk3NDQ0Y2FkZWMxMzA4MzQ1MTFjODViMjlmZmVhMTFjMjc0ZTMiPjxkczpUcmFuc2Zvcm1zPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjZW52ZWxvcGVkLXNpZ25hdHVyZSIvPjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiPjxlYzpJbmNsdXNpdmVOYW1lc3BhY2VzIHhtbG5zOmVjPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiIFByZWZpeExpc3Q9InhzIi8+PC9kczpUcmFuc2Zvcm0+PC9kczpUcmFuc2Zvcm1zPjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSIvPjxkczpEaWdlc3RWYWx1ZT5mQnZLc1dwRENNamhVTkpYQmE4d3haM3hhUE09PC9kczpEaWdlc3RWYWx1ZT48L2RzOlJlZmVyZW5jZT48L2RzOlNpZ25lZEluZm8+PGRzOlNpZ25hdHVyZVZhbHVlPm9TYmpxUmZkL0VCQk1QZ25yVlhLd29sdWlvTGErWWROd2wxL2VUWHBCODJlTEdPQXBUWE9yTXVNOUhIUzVhd3lGM1BsOXRpMTNyeTNCQnM1YnlnQUVGNUgzc3BWYjkvc29pYStKeDQ5ZDV5MWtkSjdMNzdYTDByTXV2d1h4eU5kbnNTalZsOGp2TkdyZHBJdlZMTm1OQ09wSFJDY1V2NGdUcWQ5UEVHYkMvRWJPYkZqblQ3OVRveXpPSVZLQXJnSjJXVWlCSG9ITkwvOVlRcHA5SGJaQytuOS9wVGw0eDR2RTA3QWk1ZGRLVWtITUsycURXbjYzM3NlK2lUZTNrTjI0Q01RWE9hd002YUdTeVByOVFQUUpZajRhdTl5YXBGb0QzSWpqYXAwUUJqRTVvWERCamMyaHhUeVpPcG54UnhMNHc0THI2RE9IYTdHSEZHWjdaYnlPUT09PC9kczpTaWduYXR1cmVWYWx1ZT48ZHM6S2V5SW5mbz48ZHM6WDUwOURhdGE+PGRzOlg1MDlDZXJ0aWZpY2F0ZT5NSUlESkRDQ0FneWdBd0lCQWdJVkFJcS9NVWd4UEtPMGN1WC9HdEQ3WVV2azg3R3RNQTBHQ1NxR1NJYjNEUUVCQlFVQU1Ca3hGekFWQmdOVkJBTVREbWxrY0M1dFlXTm9hVzVsTG1sME1CNFhEVEE1TURNeU5URXdOVE0xT0ZvWERUSTVNRE15TlRBNU5UTTFPRm93R1RFWE1CVUdBMVVFQXhNT2FXUndMbTFoWTJocGJtVXVhWFF3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQ2xYVjE4eDAveWhaK0QzcEhsbWhySzRwYUEreGRKS0FUN1U3UjlEZWFUUXlnd3RDakttQ3JKYnpkb2hja0x6NXBheDdlYUdlQTUzcFBDWStKZGlVMFVxNEVTOG5HMkRDWmdDdGw0UUdMVWNUdVV0SmRQcStEYllEMWNXQndFZWVmZnNpQ2xWeXVoZ0xSUE8xT1FMbC9USnA0c2xmb1lUaTBhT05nUXAwM3VHK2l4TDQ4bXlMN0dySU5IWVh0RFVEcW8yQmlteVUweXJPZTZabXZ4SmNoWjhuQnVXS3kwSjh3c08vTW5hc2J2bzc5L2M4Z2NuMEhUc3QwUURsSFhRbHp3WjRTdXEyb3M5cUtqWEFZT3pBMVZxbVR5ekpJZ2UveW5IaUowRmt3MEhOeEJhVkZUSlJOTDhSdndKc011QlQ3WVpLUm9OSzdnalQ1LzZiR2FnWU0vQWdNQkFBR2pZekJoTUVBR0ExVWRFUVE1TURlQ0RtbGtjQzV0WVdOb2FXNWxMbWwwaGlWb2RIUndjem92TDJsa2NDNXRZV05vYVc1bExtbDBMMmxrY0M5emFHbGlZbTlzWlhSb01CMEdBMVVkRGdRV0JCU0JPc1BaaVdaUlhGcU5JTklndUhmdjdqbmlkREFOQmdrcWhraUc5dzBCQVFVRkFBT0NBUUVBZVZMTjlqY3pSSU51UFV2cFhiZ2liTDJjOTlkVVJlTWNsNDduU1Z0WWVZRUJrUFBaclN6MGgzQXlWWnlhcjJWbysvZkMzZlJObWFPSnZmaVZTbStibzEwNjlpUk9JMStkR0dxMmdBd1d1UUkxcTBGN1BOUFg0em9vWStMYlpJMG9VaHVveUg4MXhlZDBXdE1scEoxYVJTQk1wUjZvVjNyZ3VBa0g2cGRyNzI1eXY2bTVXeEtjT00vTHpkRDVYdDlmUVJMN2lubzRIZmlQUEpOREczVU9LaG9BV2tWbi9ZL0N1TUxjQlBXaC8zTHhJdjRBMWJRYm5rcGR0eStRdHdmcDRRVUtraXN2N2d1ZlFQOTFhTHFVdnZSRTZVejhyNTFWSDEzZTRtRUpqSkd4TEtYV3psUDUwZ3A3YjI3QVhDVEtTUzZmVzZpQnBmQTE0UEdjV3ZEaVBRPT08L2RzOlg1MDlDZXJ0aWZpY2F0ZT48L2RzOlg1MDlEYXRhPjwvZHM6S2V5SW5mbz48L2RzOlNpZ25hdHVyZT48c2FtbDJwOlN0YXR1cz48c2FtbDJwOlN0YXR1c0NvZGUgVmFsdWU9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpzdGF0dXM6U3VjY2VzcyIvPjwvc2FtbDJwOlN0YXR1cz48c2FtbDI6QXNzZXJ0aW9uIHhtbG5zOnNhbWwyPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIiBJRD0iczIwZjFkNzYzM2UzZmEwMTI3M2E2MjdhYWUyNjgzM2I3NDY3M2QyNCIgSXNzdWVJbnN0YW50PSIyMDE3LTA5LTEzVDEyOjQ1OjUwLjU2MVoiIFZlcnNpb249IjIuMCIgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIj48c2FtbDI6SXNzdWVyPmh0dHBzOi8vZmVkZXJhLmxlcGlkYS5pdC9ndy9tZXRhZGF0YTwvc2FtbDI6SXNzdWVyPjxkczpTaWduYXR1cmUgeG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxkczpTaWduZWRJbmZvPjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPjxkczpSZWZlcmVuY2UgVVJJPSIjczIwZjFkNzYzM2UzZmEwMTI3M2E2MjdhYWUyNjgzM2I3NDY3M2QyNCI+PGRzOlRyYW5zZm9ybXM+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyI+PGVjOkluY2x1c2l2ZU5hbWVzcGFjZXMgeG1sbnM6ZWM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIgUHJlZml4TGlzdD0ieHMiLz48L2RzOlRyYW5zZm9ybT48L2RzOlRyYW5zZm9ybXM+PGRzOkRpZ2VzdE1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNzaGExIi8+PGRzOkRpZ2VzdFZhbHVlPnZSMGx0Rk1LSHVQelFXU25Wc1pMVWcxMENHbz08L2RzOkRpZ2VzdFZhbHVlPjwvZHM6UmVmZXJlbmNlPjwvZHM6U2lnbmVkSW5mbz48ZHM6U2lnbmF0dXJlVmFsdWU+ZmpXK3JjUnRxaFpVUTRYWVdiN3BpSEJHam0zZWtSREtLa1krVnhCcTlqQ3N0bG9nMUpvUldPUnpXclVvWFRPS2hWc1kxSWE1RHJmOXlWT3lTMTZKWjI5Qm8wS0E3K0hrbEg0SEFpb01IdHBjOFhKZVpNVUczQjA0M3Via0o2NWN0akJKRmJIZE4xcUJzdzZmQThHK3hWaVlzc3hPRFdnaEV2RW9XNnI3OXRkZEFYeEFjaytvZGJPU1c2K0JxMmdGcnllcnJvcVdhNFB6YTM5WlkxeHNqdHRQNFRtSFYvV2FzYnhCaExwSzRNVjJlMHcxY2RJY2lDdDBTRVhjTE9FRkY2ellRWURmUndNYk1RYXYwT1h3QzJ0YisyZ3RrcDJYKzhkandGQWd4MXJmWkFnVUI1UzBycXJsay8yNmVIZXFqaXJQMnkyRUJkanQ4a3NEdEcyL0dnPT08L2RzOlNpZ25hdHVyZVZhbHVlPjxkczpLZXlJbmZvPjxkczpYNTA5RGF0YT48ZHM6WDUwOUNlcnRpZmljYXRlPk1JSURKRENDQWd5Z0F3SUJBZ0lWQUlxL01VZ3hQS08wY3VYL0d0RDdZVXZrODdHdE1BMEdDU3FHU0liM0RRRUJCUVVBTUJreEZ6QVZCZ05WQkFNVERtbGtjQzV0WVdOb2FXNWxMbWwwTUI0WERUQTVNRE15TlRFd05UTTFPRm9YRFRJNU1ETXlOVEE1TlRNMU9Gb3dHVEVYTUJVR0ExVUVBeE1PYVdSd0xtMWhZMmhwYm1VdWFYUXdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDbFhWMTh4MC95aForRDNwSGxtaHJLNHBhQSt4ZEpLQVQ3VTdSOURlYVRReWd3dENqS21DckpiemRvaGNrTHo1cGF4N2VhR2VBNTNwUENZK0pkaVUwVXE0RVM4bkcyRENaZ0N0bDRRR0xVY1R1VXRKZFBxK0RiWUQxY1dCd0VlZWZmc2lDbFZ5dWhnTFJQTzFPUUxsL1RKcDRzbGZvWVRpMGFPTmdRcDAzdUcraXhMNDhteUw3R3JJTkhZWHREVURxbzJCaW15VTB5ck9lNlptdnhKY2haOG5CdVdLeTBKOHdzTy9NbmFzYnZvNzkvYzhnY24wSFRzdDBRRGxIWFFsendaNFN1cTJvczlxS2pYQVlPekExVnFtVHl6SklnZS95bkhpSjBGa3cwSE54QmFWRlRKUk5MOFJ2d0pzTXVCVDdZWktSb05LN2dqVDUvNmJHYWdZTS9BZ01CQUFHall6QmhNRUFHQTFVZEVRUTVNRGVDRG1sa2NDNXRZV05vYVc1bExtbDBoaVZvZEhSd2N6b3ZMMmxrY0M1dFlXTm9hVzVsTG1sMEwybGtjQzl6YUdsaVltOXNaWFJvTUIwR0ExVWREZ1FXQkJTQk9zUFppV1pSWEZxTklOSWd1SGZ2N2puaWREQU5CZ2txaGtpRzl3MEJBUVVGQUFPQ0FRRUFlVkxOOWpjelJJTnVQVXZwWGJnaWJMMmM5OWRVUmVNY2w0N25TVnRZZVlFQmtQUFpyU3owaDNBeVZaeWFyMlZvKy9mQzNmUk5tYU9KdmZpVlNtK2JvMTA2OWlST0kxK2RHR3EyZ0F3V3VRSTFxMEY3UE5QWDR6b29ZK0xiWkkwb1VodW95SDgxeGVkMFd0TWxwSjFhUlNCTXBSNm9WM3JndUFrSDZwZHI3MjV5djZtNVd4S2NPTS9MemRENVh0OWZRUkw3aW5vNEhmaVBQSk5ERzNVT0tob0FXa1ZuL1kvQ3VNTGNCUFdoLzNMeEl2NEExYlFibmtwZHR5K1F0d2ZwNFFVS2tpc3Y3Z3VmUVA5MWFMcVV2dlJFNlV6OHI1MVZIMTNlNG1FSmpKR3hMS1hXemxQNTBncDdiMjdBWENUS1NTNmZXNmlCcGZBMTRQR2NXdkRpUFE9PTwvZHM6WDUwOUNlcnRpZmljYXRlPjwvZHM6WDUwOURhdGE+PC9kczpLZXlJbmZvPjwvZHM6U2lnbmF0dXJlPjxzYW1sMjpTdWJqZWN0PjxzYW1sMjpOYW1lSUQgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDp0cmFuc2llbnQiIE5hbWVRdWFsaWZpZXI9Imh0dHBzOi8vZmVkZXJhLmxlcGlkYS5pdC9ndyI+XzExZDg4MDRiYjE0ZTU4NTJiNTdiMGUxZjA1YTJmZjE1PC9zYW1sMjpOYW1lSUQ+PHNhbWwyOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj48c2FtbDI6U3ViamVjdENvbmZpcm1hdGlvbkRhdGEgSW5SZXNwb25zZVRvPSJfNWRiZTc1YjAtN2FhZi0wMTM1LTQzNDMtMDA1MDU2YTUzZDM0IiBOb3RPbk9yQWZ0ZXI9IjIwMTctMDktMTNUMTI6NTA6NTAuNTYxWiIgUmVjaXBpZW50PSJodHRwczovL3ZhbGxpZGVsaXppZS5zb2x1emlvbmlwYS5pdC9wb3J0YWwvYXV0aC9mZWRlcmFfZW1pbGlhX3JvbWFnbmEvYXNzZXJ0aW9uX2NvbnN1bWVyIi8+PC9zYW1sMjpTdWJqZWN0Q29uZmlybWF0aW9uPjwvc2FtbDI6U3ViamVjdD48c2FtbDI6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMTctMDktMTNUMTI6NDM6NTAuNTYxWiIgTm90T25PckFmdGVyPSIyMDE3LTA5LTEzVDEyOjUwOjUwLjU2MVoiPjxzYW1sMjpBdWRpZW5jZVJlc3RyaWN0aW9uPjxzYW1sMjpBdWRpZW5jZT5odHRwczovL3ZhbGxpZGVsaXppZS5zb2x1emlvbmlwYS5pdC9wb3J0YWwvYXV0aC9mZWRlcmFfZW1pbGlhX3JvbWFnbmEvc3BfbWV0YWRhdGE8L3NhbWwyOkF1ZGllbmNlPjwvc2FtbDI6QXVkaWVuY2VSZXN0cmljdGlvbj48L3NhbWwyOkNvbmRpdGlvbnM+PHNhbWwyOkFkdmljZT48c2FtbDI6QXNzZXJ0aW9uIElEPSJzMjMxNWNlYzA2NWE2YzJlNmVkYWIyNGFlNjNmMzM4MTdlYmQwZDQwIiBJc3N1ZUluc3RhbnQ9IjIwMTctMDktMTNUMTI6NDU6NTAuNzI0WiIgVmVyc2lvbj0iMi4wIiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+PHNhbWwyOklzc3Vlcj5odHRwczovL2ZlZGVyYS5sZXBpZGEuaXQvZ3cvbWV0YWRhdGE8L3NhbWwyOklzc3Vlcj48c2FtbDI6U3ViamVjdD48c2FtbDI6TmFtZUlEIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6dHJhbnNpZW50IiBOYW1lUXVhbGlmaWVyPSJodHRwczovL2ZlZGVyYS5sZXBpZGEuaXQvZ3ciPl8zZGNhZjNlN2IzMTEzM2I2OGFmY2ZjN2VlODE2OGZmODwvc2FtbDI6TmFtZUlEPjwvc2FtbDI6U3ViamVjdD48c2FtbDI6QXR0cmlidXRlU3RhdGVtZW50PjxzYW1sMjpBdHRyaWJ1dGUgTmFtZT0iYXV0aGVudGljYXRpb25Bc3NlcnRpb24iPjxzYW1sMjpBdHRyaWJ1dGVWYWx1ZSB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4czpzdHJpbmciPlBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlWVlJHTFRnaVB6NDhjMkZ0YkRJNlFYTnpaWEowYVc5dUlIaHRiRzV6T25OaGJXd3lQU0oxY200NmIyRnphWE02Ym1GdFpYTTZkR002VTBGTlREb3lMakE2WVhOelpYSjBhVzl1SWlCSlJEMGlYMlZqTmpjeE5UVmhNbVZqTWpZNFpXVTNZVEl6TVdOa01EQXlZVFprT1RZMklpQkpjM04xWlVsdWMzUmhiblE5SWpJd01UY3RNRGt0TVROVU1USTZORFU2TkRrdU56QTNXaUlnVm1WeWMybHZiajBpTWk0d0lpQjRiV3h1Y3pwNGN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TVM5WVRVeFRZMmhsYldFaVBqeHpZVzFzTWpwSmMzTjFaWElnUm05eWJXRjBQU0oxY200NmIyRnphWE02Ym1GdFpYTTZkR002VTBGTlREb3lMakE2Ym1GdFpXbGtMV1p2Y20xaGREcGxiblJwZEhraVBtaDBkSEJ6T2k4dlptVmtaWEpoTG14bGNHbGtZUzVwZEM5cFpIQXZjSEp2Wm1sc1pTOU5aWFJoWkdGMFlTOWpiMjExYm1VdVlYSm5aVzUwWVM1bVpTNXBkQzh6UEM5ellXMXNNanBKYzNOMVpYSStQR1J6T2xOcFoyNWhkSFZ5WlNCNGJXeHVjenBrY3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzh3T1M5NGJXeGtjMmxuSXlJK1BHUnpPbE5wWjI1bFpFbHVabTgrUEdSek9rTmhibTl1YVdOaGJHbDZZWFJwYjI1TlpYUm9iMlFnUVd4bmIzSnBkR2h0UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXhMekV3TDNodGJDMWxlR010WXpFMGJpTWlMejQ4WkhNNlUybG5ibUYwZFhKbFRXVjBhRzlrSUVGc1oyOXlhWFJvYlQwaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzh3T1M5NGJXeGtjMmxuSTNKellTMXphR0V4SWk4K1BHUnpPbEpsWm1WeVpXNWpaU0JWVWtrOUlpTmZaV00yTnpFMU5XRXlaV015TmpobFpUZGhNak14WTJRd01ESmhObVE1TmpZaVBqeGtjenBVY21GdWMyWnZjbTF6UGp4a2N6cFVjbUZ1YzJadmNtMGdRV3huYjNKcGRHaHRQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0x6QTVMM2h0YkdSemFXY2paVzUyWld4dmNHVmtMWE5wWjI1aGRIVnlaU0l2UGp4a2N6cFVjbUZ1YzJadmNtMGdRV3huYjNKcGRHaHRQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBeEx6RXdMM2h0YkMxbGVHTXRZekUwYmlNaVBqeGxZenBKYm1Oc2RYTnBkbVZPWVcxbGMzQmhZMlZ6SUhodGJHNXpPbVZqUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXhMekV3TDNodGJDMWxlR010WXpFMGJpTWlJRkJ5WldacGVFeHBjM1E5SW5oeklpOCtQQzlrY3pwVWNtRnVjMlp2Y20wK1BDOWtjenBVY21GdWMyWnZjbTF6UGp4a2N6cEVhV2RsYzNSTlpYUm9iMlFnUVd4bmIzSnBkR2h0UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMekE1TDNodGJHUnphV2NqYzJoaE1TSXZQanhrY3pwRWFXZGxjM1JXWVd4MVpUNHpVVWh4TDJSMVMxTjZhamR6Y1RoVmJGVjFabHAyWVdsU1VuYzlQQzlrY3pwRWFXZGxjM1JXWVd4MVpUNDhMMlJ6T2xKbFptVnlaVzVqWlQ0OEwyUnpPbE5wWjI1bFpFbHVabTgrUEdSek9sTnBaMjVoZEhWeVpWWmhiSFZsUGtSdVozaDNkRzk0YlZKVllXOWtVRlJqUjNoUlZGWTBRM0J6Y2s5NU1HSnZaVzFzVW1ZeWJrVTFTV0pGV1hKVVoyNXFZVUp2VEZCamIzYzFSRTF3WTBweVJXTllRalJMVTNWdVIzVTRRemhRWmt4RlNYRjJVVFZFUVRSWFUzSllOelo2TWtab1kzbDFUVU5DWjFGMGJrVk1XRTlYUjFoU1lsWTNWemh6UmtWRk1DdHZWMG93VldwMVpWZDJVRUZIYW1oNFRscEZUMFY0WW5KM2JXazBaMEppU2pGbE1FSXlhSE5yZEZGSFQzQkdhbUZHY210Tk5XeGhkMFpFYWxOTUwxcEllWHBDV2poTGVWWm9iVEpoZEV4R2FITkJlSHAxZDNkdFdVY3lLMWhtZVhNcmRsbzROM2xWYkU1UWVqSndXaTgwVjFGalpqRklWRWx0SzJWMVdtOU9WWGx3YVRFM2VpOUVlSFlyWW5OMGJWSjFiVEJPZDFKcVUyazRNemxHZERGaGVHeFRjRFZrT1hCRFUzbFdjMVk1WWpNemMwcHdkMmMxVVU5cVltaExZVWxVYm5sMmNIQTFVRXBwTjFGaGEzWlZjMWhWWnowOVBDOWtjenBUYVdkdVlYUjFjbVZXWVd4MVpUNDhaSE02UzJWNVNXNW1iejQ4WkhNNldEVXdPVVJoZEdFK1BHUnpPbGcxTURsRFpYSjBhV1pwWTJGMFpUNU5TVWxFU2tSRFEwRm5lV2RCZDBsQ1FXZEpWa0ZKY1M5TlZXZDRVRXRQTUdOMVdDOUhkRVEzV1ZWMmF6ZzNSM1JOUVRCSFExTnhSMU5KWWpORVVVVkNRbEZWUVUxQ2EzaEdla0ZXQ2tKblRsWkNRVTFVUkcxc2EyTkROWFJaVjA1dllWYzFiRXh0YkRCTlFqUllSRlJCTlUxRVRYbE9WRVYzVGxSTk1VOUdiMWhFVkVrMVRVUk5lVTVVUVRWT1ZFMHhUMFp2ZDBkVVJWZ0tUVUpWUjBFeFZVVkJlRTFQWVZkU2QweHRNV2haTW1od1ltMVZkV0ZZVVhkblowVnBUVUV3UjBOVGNVZFRTV0l6UkZGRlFrRlJWVUZCTkVsQ1JIZEJkMmRuUlV0QmIwbENRVkZEYkFwWVZqRTRlREF2ZVdoYUswUXpjRWhzYldoeVN6UndZVUVyZUdSS1MwRlVOMVUzVWpsRVpXRlVVWGxuZDNSRGFrdHRRM0pLWW5wa2IyaGphMHg2TlhCaGVEZGxZVWRsUVRVemNGQkRDbGtyU21ScFZUQlZjVFJGVXpodVJ6SkVRMXBuUTNSc05GRkhURlZqVkhWVmRFcGtVSEVyUkdKWlJERmpWMEozUldWbFptWnphVU5zVm5sMWFHZE1VbEJQTVU5UlRHd3ZWRXB3TkhNS2JHWnZXVlJwTUdGUFRtZFJjREF6ZFVjcmFYaE1ORGh0ZVV3M1IzSkpUa2haV0hSRVZVUnhiekpDYVcxNVZUQjVjazlsTmxwdGRuaEtZMmhhT0c1Q2RWZExlVEJLT0hkelR5OU5iZ3BoYzJKMmJ6YzVMMk00WjJOdU1FaFVjM1F3VVVSc1NGaFJiSHAzV2pSVGRYRXliM001Y1V0cVdFRlpUM3BCTVZaeGJWUjVla3BKWjJVdmVXNUlhVW93Um10M01FaE9lRUpoVmtaVUNrcFNUa3c0VW5aM1NuTk5kVUpVTjFsYVMxSnZUa3MzWjJwVU5TODJZa2RoWjFsTkwwRm5UVUpCUVVkcVdYcENhRTFGUVVkQk1WVmtSVkZSTlUxRVpVTkViV3hyWTBNMWRGbFhUbThLWVZjMWJFeHRiREJvYVZadlpFaFNkMk42YjNaTU1teHJZME0xZEZsWFRtOWhWelZzVEcxc01Fd3liR3RqUXpsNllVZHNhVmx0T1hOYVdGSnZUVUl3UjBFeFZXUkVaMUZYUWtKVFFncFBjMUJhYVZkYVVsaEdjVTVKVGtsbmRVaG1kamRxYm1sa1JFRk9RbWRyY1docmFVYzVkekJDUVZGVlJrRkJUME5CVVVWQlpWWk1UamxxWTNwU1NVNTFVRlYyY0ZoaVoybGlUREpqQ2prNVpGVlNaVTFqYkRRM2JsTldkRmxsV1VWQ2ExQlFXbkpUZWpCb00wRjVWbHA1WVhJeVZtOHJMMlpETTJaU1RtMWhUMHAyWm1sV1UyMHJZbTh4TURZNWFWSlBTVEVyWkVkSGNUSUtaMEYzVjNWUlNURnhNRVkzVUU1UVdEUjZiMjlaSzB4aVdra3diMVZvZFc5NVNEZ3hlR1ZrTUZkMFRXeHdTakZoVWxOQ1RYQlNObTlXTTNKbmRVRnJTRFp3WkhJM01qVjVkalp0TlFwWGVFdGpUMDB2VEhwa1JEVllkRGxtVVZKTU4ybHVielJJWm1sUVVFcE9SRWN6VlU5TGFHOUJWMnRXYmk5WkwwTjFUVXhqUWxCWGFDOHpUSGhKZGpSQk1XSlJZbTVyY0dSMGVTdFJDblIzWm5BMFVWVkxhMmx6ZGpkbmRXWlJVRGt4WVV4eFZYWjJVa1UyVlhvNGNqVXhWa2d4TTJVMGJVVktha3BIZUV4TFdGZDZiRkExTUdkd04ySXlOMEZZUTFSTFUxTTJabGMyYVVJS2NHWkJNVFJRUjJOWGRrUnBVRkU5UFR3dlpITTZXRFV3T1VObGNuUnBabWxqWVhSbFBqd3ZaSE02V0RVd09VUmhkR0UrUEM5a2N6cExaWGxKYm1adlBqd3ZaSE02VTJsbmJtRjBkWEpsUGp4ellXMXNNanBUZFdKcVpXTjBQanh6WVcxc01qcE9ZVzFsU1VRZ1JtOXliV0YwUFNKMWNtNDZiMkZ6YVhNNmJtRnRaWE02ZEdNNlUwRk5URG95TGpBNmJtRnRaV2xrTFdadmNtMWhkRHAwY21GdWMybGxiblFpSUU1aGJXVlJkV0ZzYVdacFpYSTlJbWgwZEhCek9pOHZabVZrWlhKaExteGxjR2xrWVM1cGRDOXBaSEF2Y0hKdlptbHNaUzlOWlhSaFpHRjBZU0krWDJRM1pqQmhNMkUwTmpreFpEQXpNVEl3TVdJMlpHRmxZVGt4TW1RM09EWTJQQzl6WVcxc01qcE9ZVzFsU1VRK1BITmhiV3d5T2xOMVltcGxZM1JEYjI1bWFYSnRZWFJwYjI0Z1RXVjBhRzlrUFNKMWNtNDZiMkZ6YVhNNmJtRnRaWE02ZEdNNlUwRk5URG95TGpBNlkyMDZZbVZoY21WeUlqNDhjMkZ0YkRJNlUzVmlhbVZqZEVOdmJtWnBjbTFoZEdsdmJrUmhkR0VnUVdSa2NtVnpjejBpT1RNdU1UUTVMak01TGpVNElpQkpibEpsYzNCdmJuTmxWRzg5SW5NeU5HSTJNREpqWlRsaU0yVmhNREV4TmprMU1HRm1ZakU1WkdKaFpHRTJOV0psTnpOaU1qTWlJRTV2ZEU5dVQzSkJablJsY2owaU1qQXhOeTB3T1MweE0xUXhNam8xTURvME9TNDNNRGRhSWlCU1pXTnBjR2xsYm5ROUltaDBkSEJ6T2k4dlptVmtaWEpoTG14bGNHbGtZUzVwZEM5bmR5OUJjM05sY25ScGIyNURiMjV6ZFcxbGNsQnliM2g1TDFOQlRVd3lJaTgrUEM5ellXMXNNanBUZFdKcVpXTjBRMjl1Wm1seWJXRjBhVzl1UGp3dmMyRnRiREk2VTNWaWFtVmpkRDQ4YzJGdGJESTZRMjl1WkdsMGFXOXVjeUJPYjNSQ1pXWnZjbVU5SWpJd01UY3RNRGt0TVROVU1USTZORE02TkRrdU56QTNXaUlnVG05MFQyNVBja0ZtZEdWeVBTSXlNREUzTFRBNUxURXpWREV5T2pVd09qUTVMamN3TjFvaVBqeHpZVzFzTWpwQmRXUnBaVzVqWlZKbGMzUnlhV04wYVc5dVBqeHpZVzFzTWpwQmRXUnBaVzVqWlQ1b2RIUndjem92TDJabFpHVnlZUzVzWlhCcFpHRXVhWFF2WjNjdmJXVjBZV1JoZEdFOEwzTmhiV3d5T2tGMVpHbGxibU5sUGp3dmMyRnRiREk2UVhWa2FXVnVZMlZTWlhOMGNtbGpkR2x2Ymo0OEwzTmhiV3d5T2tOdmJtUnBkR2x2Ym5NK1BITmhiV3d5T2tGMWRHaHVVM1JoZEdWdFpXNTBJRUYxZEdodVNXNXpkR0Z1ZEQwaU1qQXhOeTB3T1MweE0xUXhNam94T0RvME9DNDVOVEZhSWlCVFpYTnphVzl1U1c1a1pYZzlJalV5WVdRMVlXTTVPR1kwTnpNNVlUaG1PVFpsWXpjelpEUTNZakZqWldFM09UQTVPR0ZtWlRrMk4yTm1ORFExTkRFNFlUZGlNak5pT1RFM1ltTm1PR1VpUGp4ellXMXNNanBUZFdKcVpXTjBURzlqWVd4cGRIa2dRV1JrY21WemN6MGlPVE11TVRRNUxqTTVMalU0SWk4K1BITmhiV3d5T2tGMWRHaHVRMjl1ZEdWNGRENDhjMkZ0YkRJNlFYVjBhRzVEYjI1MFpYaDBRMnhoYzNOU1pXWStkWEp1T205aGMybHpPbTVoYldWek9uUmpPbE5CVFV3Nk1pNHdPbUZqT21Oc1lYTnpaWE02VTJWamRYSmxVbVZ0YjNSbFVHRnpjM2R2Y21ROEwzTmhiV3d5T2tGMWRHaHVRMjl1ZEdWNGRFTnNZWE56VW1WbVBqd3ZjMkZ0YkRJNlFYVjBhRzVEYjI1MFpYaDBQand2YzJGdGJESTZRWFYwYUc1VGRHRjBaVzFsYm5RK1BITmhiV3d5T2tGMGRISnBZblYwWlZOMFlYUmxiV1Z1ZEQ0OGMyRnRiREk2UVhSMGNtbGlkWFJsSUVaeWFXVnVaR3g1VG1GdFpUMGlSRzl0YVc1cGJ5QlZkR1Z1ZEdVZ1JtVmtaWEpoSWlCT1lXMWxQU0ptWldSbGNtRlZjMlZ5Ukc5dFlXbHVJaUJPWVcxbFJtOXliV0YwUFNKMWNtNDZiMkZ6YVhNNmJtRnRaWE02ZEdNNlUwRk5URG95TGpBNllYUjBjbTVoYldVdFptOXliV0YwT25WeWFTSStQSE5oYld3eU9rRjBkSEpwWW5WMFpWWmhiSFZsSUhodGJHNXpPbmh6YVQwaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNUzlZVFV4VFkyaGxiV0V0YVc1emRHRnVZMlVpSUhoemFUcDBlWEJsUFNKNGN6cHpkSEpwYm1jaVBtTnZiWFZ1WlM1aGNtZGxiblJoTG1abExtbDBQQzl6WVcxc01qcEJkSFJ5YVdKMWRHVldZV3gxWlQ0OEwzTmhiV3d5T2tGMGRISnBZblYwWlQ0OGMyRnRiREk2UVhSMGNtbGlkWFJsSUVaeWFXVnVaR3g1VG1GdFpUMGlVSEp2Wm1WemMybHZibVVpSUU1aGJXVTlJbXhoZG05eWJ5SWdUbUZ0WlVadmNtMWhkRDBpZFhKdU9tOWhjMmx6T201aGJXVnpPblJqT2xOQlRVdzZNaTR3T21GMGRISnVZVzFsTFdadmNtMWhkRHAxY21raVBqeHpZVzFzTWpwQmRIUnlhV0oxZEdWV1lXeDFaU0I0Yld4dWN6cDRjMms5SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01ERXZXRTFNVTJOb1pXMWhMV2x1YzNSaGJtTmxJaUI0YzJrNmRIbHdaVDBpZUhNNmMzUnlhVzVuSWo1RGIyMTFibVVnWkdrZ1FYSm5aVzUwWVR3dmMyRnRiREk2UVhSMGNtbGlkWFJsVm1Gc2RXVStQQzl6WVcxc01qcEJkSFJ5YVdKMWRHVStQSE5oYld3eU9rRjBkSEpwWW5WMFpTQkdjbWxsYm1Sc2VVNWhiV1U5SWtsa1pXNTBhV1pwWTJGMGFYWnZJSFYwWlc1MFpTSWdUbUZ0WlQwaWRYTmxjbWxrSWlCT1lXMWxSbTl5YldGMFBTSjFjbTQ2YjJGemFYTTZibUZ0WlhNNmRHTTZVMEZOVERveUxqQTZZWFIwY201aGJXVXRabTl5YldGME9uVnlhU0krUEhOaGJXd3lPa0YwZEhKcFluVjBaVlpoYkhWbElIaHRiRzV6T25oemFUMGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TVM5WVRVeFRZMmhsYldFdGFXNXpkR0Z1WTJVaUlIaHphVHAwZVhCbFBTSjRjenB6ZEhKcGJtY2lQa3hPV2xKU1ZEWTJSVEEyUWpJME9VVkFZMjl0ZFc1bExtRnlaMlZ1ZEdFdVptVXVhWFE4TDNOaGJXd3lPa0YwZEhKcFluVjBaVlpoYkhWbFBqd3ZjMkZ0YkRJNlFYUjBjbWxpZFhSbFBqeHpZVzFzTWpwQmRIUnlhV0oxZEdVZ1JuSnBaVzVrYkhsT1lXMWxQU0pUZEdGMGJ5QmthU0J1WVhOamFYUmhJaUJPWVcxbFBTSnpkR0YwYjA1aGMyTnBkR0VpSUU1aGJXVkdiM0p0WVhROUluVnlianB2WVhOcGN6cHVZVzFsY3pwMFl6cFRRVTFNT2pJdU1EcGhkSFJ5Ym1GdFpTMW1iM0p0WVhRNmRYSnBJajQ4YzJGdGJESTZRWFIwY21saWRYUmxWbUZzZFdVZ2VHMXNibk02ZUhOcFBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF4TDFoTlRGTmphR1Z0WVMxcGJuTjBZVzVqWlNJZ2VITnBPblI1Y0dVOUluaHpPbk4wY21sdVp5SStTVlJCVEVsQlBDOXpZVzFzTWpwQmRIUnlhV0oxZEdWV1lXeDFaVDQ4TDNOaGJXd3lPa0YwZEhKcFluVjBaVDQ4YzJGdGJESTZRWFIwY21saWRYUmxJRVp5YVdWdVpHeDVUbUZ0WlQwaVEyOW5ibTl0WlNJZ1RtRnRaVDBpYkdGemRHNWhiV1VpSUU1aGJXVkdiM0p0WVhROUluVnlianB2WVhOcGN6cHVZVzFsY3pwMFl6cFRRVTFNT2pJdU1EcGhkSFJ5Ym1GdFpTMW1iM0p0WVhRNmRYSnBJajQ4YzJGdGJESTZRWFIwY21saWRYUmxWbUZzZFdVZ2VHMXNibk02ZUhOcFBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF4TDFoTlRGTmphR1Z0WVMxcGJuTjBZVzVqWlNJZ2VITnBPblI1Y0dVOUluaHpPbk4wY21sdVp5SStiR0Z1ZW1GeWIyNWxQQzl6WVcxc01qcEJkSFJ5YVdKMWRHVldZV3gxWlQ0OEwzTmhiV3d5T2tGMGRISnBZblYwWlQ0OGMyRnRiREk2UVhSMGNtbGlkWFJsSUVaeWFXVnVaR3g1VG1GdFpUMGlVMlZ6YzI4aUlFNWhiV1U5SW5ObGMzTnZJaUJPWVcxbFJtOXliV0YwUFNKMWNtNDZiMkZ6YVhNNmJtRnRaWE02ZEdNNlUwRk5URG95TGpBNllYUjBjbTVoYldVdFptOXliV0YwT25WeWFTSStQSE5oYld3eU9rRjBkSEpwWW5WMFpWWmhiSFZsSUhodGJHNXpPbmh6YVQwaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNUzlZVFV4VFkyaGxiV0V0YVc1emRHRnVZMlVpSUhoemFUcDBlWEJsUFNKNGN6cHpkSEpwYm1jaVBrMDhMM05oYld3eU9rRjBkSEpwWW5WMFpWWmhiSFZsUGp3dmMyRnRiREk2UVhSMGNtbGlkWFJsUGp4ellXMXNNanBCZEhSeWFXSjFkR1VnUm5KcFpXNWtiSGxPWVcxbFBTSlFjbTkyYVc1amFXRWdaR2tnY21WemFXUmxibnBoSWlCT1lXMWxQU0p3Y205MmFXNWphV0ZTWlhOcFpHVnVlbUVpSUU1aGJXVkdiM0p0WVhROUluVnlianB2WVhOcGN6cHVZVzFsY3pwMFl6cFRRVTFNT2pJdU1EcGhkSFJ5Ym1GdFpTMW1iM0p0WVhRNmRYSnBJajQ4YzJGdGJESTZRWFIwY21saWRYUmxWbUZzZFdVZ2VHMXNibk02ZUhOcFBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF4TDFoTlRGTmphR1Z0WVMxcGJuTjBZVzVqWlNJZ2VITnBPblI1Y0dVOUluaHpPbk4wY21sdVp5SStRazg4TDNOaGJXd3lPa0YwZEhKcFluVjBaVlpoYkhWbFBqd3ZjMkZ0YkRJNlFYUjBjbWxpZFhSbFBqeHpZVzFzTWpwQmRIUnlhV0oxZEdVZ1JuSnBaVzVrYkhsT1lXMWxQU0pUZEdGMGJ5QmthU0J5WlhOcFpHVnVlbUVpSUU1aGJXVTlJbk4wWVhSdlVtVnphV1JsYm5waElpQk9ZVzFsUm05eWJXRjBQU0oxY200NmIyRnphWE02Ym1GdFpYTTZkR002VTBGTlREb3lMakE2WVhSMGNtNWhiV1V0Wm05eWJXRjBPblZ5YVNJK1BITmhiV3d5T2tGMGRISnBZblYwWlZaaGJIVmxJSGh0Ykc1ek9uaHphVDBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01TOVlUVXhUWTJobGJXRXRhVzV6ZEdGdVkyVWlJSGh6YVRwMGVYQmxQU0o0Y3pwemRISnBibWNpUGtsVVFVeEpRVHd2YzJGdGJESTZRWFIwY21saWRYUmxWbUZzZFdVK1BDOXpZVzFzTWpwQmRIUnlhV0oxZEdVK1BITmhiV3d5T2tGMGRISnBZblYwWlNCR2NtbGxibVJzZVU1aGJXVTlJa1JoZEdFZ1pHa2dibUZ6WTJsMFlTSWdUbUZ0WlQwaVpHRjBZVTVoYzJOcGRHRWlJRTVoYldWR2IzSnRZWFE5SW5WeWJqcHZZWE5wY3pwdVlXMWxjenAwWXpwVFFVMU1Pakl1TURwaGRIUnlibUZ0WlMxbWIzSnRZWFE2ZFhKcElqNDhjMkZ0YkRJNlFYUjBjbWxpZFhSbFZtRnNkV1VnZUcxc2JuTTZlSE5wUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXhMMWhOVEZOamFHVnRZUzFwYm5OMFlXNWpaU0lnZUhOcE9uUjVjR1U5SW5oek9uTjBjbWx1WnlJK01EWXZNRFV2TVRrMk5qd3ZjMkZ0YkRJNlFYUjBjbWxpZFhSbFZtRnNkV1UrUEM5ellXMXNNanBCZEhSeWFXSjFkR1UrUEhOaGJXd3lPa0YwZEhKcFluVjBaU0JHY21sbGJtUnNlVTVoYldVOUlrTnZiWFZ1WlNCa2FTQnlaWE5wWkdWdWVtRWlJRTVoYldVOUltTnZiWFZ1WlZKbGMybGtaVzU2WVNJZ1RtRnRaVVp2Y20xaGREMGlkWEp1T205aGMybHpPbTVoYldWek9uUmpPbE5CVFV3Nk1pNHdPbUYwZEhKdVlXMWxMV1p2Y20xaGREcDFjbWtpUGp4ellXMXNNanBCZEhSeWFXSjFkR1ZXWVd4MVpTQjRiV3h1Y3pwNGMyazlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURFdldFMU1VMk5vWlcxaExXbHVjM1JoYm1ObElpQjRjMms2ZEhsd1pUMGllSE02YzNSeWFXNW5JajVDVlVSU1NVODhMM05oYld3eU9rRjBkSEpwWW5WMFpWWmhiSFZsUGp3dmMyRnRiREk2UVhSMGNtbGlkWFJsUGp4ellXMXNNanBCZEhSeWFXSjFkR1VnUm5KcFpXNWtiSGxPWVcxbFBTSkRaV3hzZFd4aGNtVWlJRTVoYldVOUltTmxiR3gxYkdGeVpTSWdUbUZ0WlVadmNtMWhkRDBpZFhKdU9tOWhjMmx6T201aGJXVnpPblJqT2xOQlRVdzZNaTR3T21GMGRISnVZVzFsTFdadmNtMWhkRHAxY21raVBqeHpZVzFzTWpwQmRIUnlhV0oxZEdWV1lXeDFaU0I0Yld4dWN6cDRjMms5SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01ERXZXRTFNVTJOb1pXMWhMV2x1YzNSaGJtTmxJaUI0YzJrNmRIbHdaVDBpZUhNNmMzUnlhVzVuSWo0ek1qazRNekl6TnpZelBDOXpZVzFzTWpwQmRIUnlhV0oxZEdWV1lXeDFaVDQ4TDNOaGJXd3lPa0YwZEhKcFluVjBaVDQ4YzJGdGJESTZRWFIwY21saWRYUmxJRVp5YVdWdVpHeDVUbUZ0WlQwaVVYVmhiR2xtYVdWa1ZYTmxja0ZzYVdGeklpQk9ZVzFsUFNKeGRXRnNhV1pwWldSVmMyVnlRV3hwWVhNaUlFNWhiV1ZHYjNKdFlYUTlJblZ5YmpwdllYTnBjenB1WVcxbGN6cDBZenBUUVUxTU9qSXVNRHBoZEhSeWJtRnRaUzFtYjNKdFlYUTZkWEpwSWo0OGMyRnRiREk2UVhSMGNtbGlkWFJsVm1Gc2RXVWdlRzFzYm5NNmVITnBQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBeEwxaE5URk5qYUdWdFlTMXBibk4wWVc1alpTSWdlSE5wT25SNWNHVTlJbmh6T25OMGNtbHVaeUkrVEdGdWVtRnliMjVsWDFKdlltVnlkRzlBWTI5dGRXNWxMbUZ5WjJWdWRHRXVabVV1YVhROEwzTmhiV3d5T2tGMGRISnBZblYwWlZaaGJIVmxQand2YzJGdGJESTZRWFIwY21saWRYUmxQanh6WVcxc01qcEJkSFJ5YVdKMWRHVWdSbkpwWlc1a2JIbE9ZVzFsUFNKRGIyUnBZMlVnUm1selkyRnNaU0lnVG1GdFpUMGlRMjlrYVdObFJtbHpZMkZzWlNJZ1RtRnRaVVp2Y20xaGREMGlkWEp1T205aGMybHpPbTVoYldWek9uUmpPbE5CVFV3Nk1pNHdPbUYwZEhKdVlXMWxMV1p2Y20xaGREcDFjbWtpUGp4ellXMXNNanBCZEhSeWFXSjFkR1ZXWVd4MVpTQjRiV3h1Y3pwNGMyazlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURFdldFMU1VMk5vWlcxaExXbHVjM1JoYm1ObElpQjRjMms2ZEhsd1pUMGllSE02YzNSeWFXNW5JajVNVGxwU1VsUTJOa1V3TmtJeU5EbEZQQzl6WVcxc01qcEJkSFJ5YVdKMWRHVldZV3gxWlQ0OEwzTmhiV3d5T2tGMGRISnBZblYwWlQ0OGMyRnRiREk2UVhSMGNtbGlkWFJsSUVaeWFXVnVaR3g1VG1GdFpUMGlRMjl0ZFc1bElHUnBJRzVoYzJOcGRHRWlJRTVoYldVOUlteDFiMmR2VG1GelkybDBZU0lnVG1GdFpVWnZjbTFoZEQwaWRYSnVPbTloYzJsek9tNWhiV1Z6T25Sak9sTkJUVXc2TWk0d09tRjBkSEp1WVcxbExXWnZjbTFoZERwMWNta2lQanh6WVcxc01qcEJkSFJ5YVdKMWRHVldZV3gxWlNCNGJXeHVjenA0YzJrOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREV2V0UxTVUyTm9aVzFoTFdsdWMzUmhibU5sSWlCNGMyazZkSGx3WlQwaWVITTZjM1J5YVc1bklqNUNWVVJTU1U4OEwzTmhiV3d5T2tGMGRISnBZblYwWlZaaGJIVmxQand2YzJGdGJESTZRWFIwY21saWRYUmxQanh6WVcxc01qcEJkSFJ5YVdKMWRHVWdSbkpwWlc1a2JIbE9ZVzFsUFNKSmJtUnBjbWw2ZW04Z1pHa2daRzl0YVdOcGJHbHZJaUJPWVcxbFBTSnBibVJwY21sNmVtOUViMjFwWTJsc2FXOGlJRTVoYldWR2IzSnRZWFE5SW5WeWJqcHZZWE5wY3pwdVlXMWxjenAwWXpwVFFVMU1Pakl1TURwaGRIUnlibUZ0WlMxbWIzSnRZWFE2ZFhKcElqNDhjMkZ0YkRJNlFYUjBjbWxpZFhSbFZtRnNkV1VnZUcxc2JuTTZlSE5wUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXhMMWhOVEZOamFHVnRZUzFwYm5OMFlXNWpaU0lnZUhOcE9uUjVjR1U5SW5oek9uTjBjbWx1WnlJK1ZtbGhJRk5sYkhaaElEYzFMemc4TDNOaGJXd3lPa0YwZEhKcFluVjBaVlpoYkhWbFBqd3ZjMkZ0YkRJNlFYUjBjbWxpZFhSbFBqeHpZVzFzTWpwQmRIUnlhV0oxZEdVZ1JuSnBaVzVrYkhsT1lXMWxQU0pWYzJWeVFXeHBZWE1pSUU1aGJXVTlJblZ6WlhKQmJHbGhjeUlnVG1GdFpVWnZjbTFoZEQwaWRYSnVPbTloYzJsek9tNWhiV1Z6T25Sak9sTkJUVXc2TWk0d09tRjBkSEp1WVcxbExXWnZjbTFoZERwMWNta2lQanh6WVcxc01qcEJkSFJ5YVdKMWRHVldZV3gxWlNCNGJXeHVjenA0YzJrOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREV2V0UxTVUyTm9aVzFoTFdsdWMzUmhibU5sSWlCNGMyazZkSGx3WlQwaWVITTZjM1J5YVc1bklqNU1ZVzU2WVhKdmJtVmZVbTlpWlhKMGJ6d3ZjMkZ0YkRJNlFYUjBjbWxpZFhSbFZtRnNkV1UrUEM5ellXMXNNanBCZEhSeWFXSjFkR1UrUEhOaGJXd3lPa0YwZEhKcFluVjBaU0JHY21sbGJtUnNlVTVoYldVOUlrTkJVQ0JrYVNCa2IyMXBZMmxzYVc4aUlFNWhiV1U5SW1OaGNFUnZiV2xqYVd4cGJ5SWdUbUZ0WlVadmNtMWhkRDBpZFhKdU9tOWhjMmx6T201aGJXVnpPblJqT2xOQlRVdzZNaTR3T21GMGRISnVZVzFsTFdadmNtMWhkRHAxY21raVBqeHpZVzFzTWpwQmRIUnlhV0oxZEdWV1lXeDFaU0I0Yld4dWN6cDRjMms5SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01ERXZXRTFNVTJOb1pXMWhMV2x1YzNSaGJtTmxJaUI0YzJrNmRIbHdaVDBpZUhNNmMzUnlhVzVuSWo0ME1EQTJNand2YzJGdGJESTZRWFIwY21saWRYUmxWbUZzZFdVK1BDOXpZVzFzTWpwQmRIUnlhV0oxZEdVK1BITmhiV3d5T2tGMGRISnBZblYwWlNCR2NtbGxibVJzZVU1aGJXVTlJbEJ5YjNacGJtTnBZU0JrYVNCdVlYTmphWFJoSWlCT1lXMWxQU0p3Y205MmFXNWphV0ZPWVhOamFYUmhJaUJPWVcxbFJtOXliV0YwUFNKMWNtNDZiMkZ6YVhNNmJtRnRaWE02ZEdNNlUwRk5URG95TGpBNllYUjBjbTVoYldVdFptOXliV0YwT25WeWFTSStQSE5oYld3eU9rRjBkSEpwWW5WMFpWWmhiSFZsSUhodGJHNXpPbmh6YVQwaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNUzlZVFV4VFkyaGxiV0V0YVc1emRHRnVZMlVpSUhoemFUcDBlWEJsUFNKNGN6cHpkSEpwYm1jaVBrSlBQQzl6WVcxc01qcEJkSFJ5YVdKMWRHVldZV3gxWlQ0OEwzTmhiV3d5T2tGMGRISnBZblYwWlQ0OGMyRnRiREk2UVhSMGNtbGlkWFJsSUVaeWFXVnVaR3g1VG1GdFpUMGlWR1ZzWldadmJtOGlJRTVoYldVOUluUmxiR1ZtYjI1dklpQk9ZVzFsUm05eWJXRjBQU0oxY200NmIyRnphWE02Ym1GdFpYTTZkR002VTBGTlREb3lMakE2WVhSMGNtNWhiV1V0Wm05eWJXRjBPblZ5YVNJK1BITmhiV3d5T2tGMGRISnBZblYwWlZaaGJIVmxJSGh0Ykc1ek9uaHphVDBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01TOVlUVXhUWTJobGJXRXRhVzV6ZEdGdVkyVWlJSGh6YVRwMGVYQmxQU0o0Y3pwemRISnBibWNpUGpBMU16SXRNek13TXpFeVBDOXpZVzFzTWpwQmRIUnlhV0oxZEdWV1lXeDFaVDQ4TDNOaGJXd3lPa0YwZEhKcFluVjBaVDQ4YzJGdGJESTZRWFIwY21saWRYUmxJRVp5YVdWdVpHeDVUbUZ0WlQwaVEyOXRkVzVsSUdScElHUnZiV2xqYVd4cGJ5SWdUbUZ0WlQwaVkyOXRkVzVsUkc5dGFXTnBiR2x2SWlCT1lXMWxSbTl5YldGMFBTSjFjbTQ2YjJGemFYTTZibUZ0WlhNNmRHTTZVMEZOVERveUxqQTZZWFIwY201aGJXVXRabTl5YldGME9uVnlhU0krUEhOaGJXd3lPa0YwZEhKcFluVjBaVlpoYkhWbElIaHRiRzV6T25oemFUMGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TVM5WVRVeFRZMmhsYldFdGFXNXpkR0Z1WTJVaUlIaHphVHAwZVhCbFBTSjRjenB6ZEhKcGJtY2lQazFQVEVsT1JVeE1RVHd2YzJGdGJESTZRWFIwY21saWRYUmxWbUZzZFdVK1BDOXpZVzFzTWpwQmRIUnlhV0oxZEdVK1BITmhiV3d5T2tGMGRISnBZblYwWlNCR2NtbGxibVJzZVU1aGJXVTlJa1J2YldsamFXeHBieUJsYkdWMGRISnZibWxqYnlJZ1RtRnRaVDBpWlcxaGFXeEJaR1J5WlhOeklpQk9ZVzFsUm05eWJXRjBQU0oxY200NmIyRnphWE02Ym1GdFpYTTZkR002VTBGTlREb3lMakE2WVhSMGNtNWhiV1V0Wm05eWJXRjBPblZ5YVNJK1BITmhiV3d5T2tGMGRISnBZblYwWlZaaGJIVmxJSGh0Ykc1ek9uaHphVDBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01TOVlUVXhUWTJobGJXRXRhVzV6ZEdGdVkyVWlJSGh6YVRwMGVYQmxQU0o0Y3pwemRISnBibWNpUG14dWVuSnlkRFkyWlRBMllqSTBPV1ZBY0c5emRHVnRZV2xzWTJWeWRHbG1hV05oZEdFdWFYUThMM05oYld3eU9rRjBkSEpwWW5WMFpWWmhiSFZsUGp3dmMyRnRiREk2UVhSMGNtbGlkWFJsUGp4ellXMXNNanBCZEhSeWFXSjFkR1VnUm5KcFpXNWtiSGxPWVcxbFBTSkRRVkFnWkdrZ2NtVnphV1JsYm5waElpQk9ZVzFsUFNKallYQlNaWE5wWkdWdWVtRWlJRTVoYldWR2IzSnRZWFE5SW5WeWJqcHZZWE5wY3pwdVlXMWxjenAwWXpwVFFVMU1Pakl1TURwaGRIUnlibUZ0WlMxbWIzSnRZWFE2ZFhKcElqNDhjMkZ0YkRJNlFYUjBjbWxpZFhSbFZtRnNkV1VnZUcxc2JuTTZlSE5wUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXhMMWhOVEZOamFHVnRZUzFwYm5OMFlXNWpaU0lnZUhOcE9uUjVjR1U5SW5oek9uTjBjbWx1WnlJK05EQXdOakk4TDNOaGJXd3lPa0YwZEhKcFluVjBaVlpoYkhWbFBqd3ZjMkZ0YkRJNlFYUjBjbWxpZFhSbFBqeHpZVzFzTWpwQmRIUnlhV0oxZEdVZ1JuSnBaVzVrYkhsT1lXMWxQU0pPYjIxbElpQk9ZVzFsUFNKbWFYSnpkRzVoYldVaUlFNWhiV1ZHYjNKdFlYUTlJblZ5YmpwdllYTnBjenB1WVcxbGN6cDBZenBUUVUxTU9qSXVNRHBoZEhSeWJtRnRaUzFtYjNKdFlYUTZkWEpwSWo0OGMyRnRiREk2UVhSMGNtbGlkWFJsVm1Gc2RXVWdlRzFzYm5NNmVITnBQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBeEwxaE5URk5qYUdWdFlTMXBibk4wWVc1alpTSWdlSE5wT25SNWNHVTlJbmh6T25OMGNtbHVaeUkrY205aVpYSjBiend2YzJGdGJESTZRWFIwY21saWRYUmxWbUZzZFdVK1BDOXpZVzFzTWpwQmRIUnlhV0oxZEdVK1BITmhiV3d5T2tGMGRISnBZblYwWlNCR2NtbGxibVJzZVU1aGJXVTlJbFZ6WlhJZ2FXUmxiblJwZEhrZ2RISjFjM1FnYkdWMlpXd2lJRTVoYldVOUluUnlkWE4wVEdWMlpXd2lJRTVoYldWR2IzSnRZWFE5SW5WeWJqcHZZWE5wY3pwdVlXMWxjenAwWXpwVFFVMU1Pakl1TURwaGRIUnlibUZ0WlMxbWIzSnRZWFE2ZFhKcElqNDhjMkZ0YkRJNlFYUjBjbWxpZFhSbFZtRnNkV1VnZUcxc2JuTTZlSE5wUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXhMMWhOVEZOamFHVnRZUzFwYm5OMFlXNWpaU0lnZUhOcE9uUjVjR1U5SW5oek9uTjBjbWx1WnlJK1FXeDBiend2YzJGdGJESTZRWFIwY21saWRYUmxWbUZzZFdVK1BDOXpZVzFzTWpwQmRIUnlhV0oxZEdVK1BITmhiV3d5T2tGMGRISnBZblYwWlNCR2NtbGxibVJzZVU1aGJXVTlJa052YlhWdVpTQmthU0J5WlhOcFpHVnVlbUVpSUU1aGJXVTlJbU5wZEhSaFVtVnphV1JsYm5waElpQk9ZVzFsUm05eWJXRjBQU0oxY200NmIyRnphWE02Ym1GdFpYTTZkR002VTBGTlREb3lMakE2WVhSMGNtNWhiV1V0Wm05eWJXRjBPblZ5YVNJK1BITmhiV3d5T2tGMGRISnBZblYwWlZaaGJIVmxJSGh0Ykc1ek9uaHphVDBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01TOVlUVXhUWTJobGJXRXRhVzV6ZEdGdVkyVWlJSGh6YVRwMGVYQmxQU0o0Y3pwemRISnBibWNpUGtKVlJGSkpUend2YzJGdGJESTZRWFIwY21saWRYUmxWbUZzZFdVK1BDOXpZVzFzTWpwQmRIUnlhV0oxZEdVK1BITmhiV3d5T2tGMGRISnBZblYwWlNCR2NtbGxibVJzZVU1aGJXVTlJa052WjI1dmJXVWlJRTVoYldVOUltTnZaMjV2YldVaUlFNWhiV1ZHYjNKdFlYUTlJblZ5YmpwdllYTnBjenB1WVcxbGN6cDBZenBUUVUxTU9qSXVNRHBoZEhSeWJtRnRaUzFtYjNKdFlYUTZkWEpwSWo0OGMyRnRiREk2UVhSMGNtbGlkWFJsVm1Gc2RXVWdlRzFzYm5NNmVITnBQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBeEwxaE5URk5qYUdWdFlTMXBibk4wWVc1alpTSWdlSE5wT25SNWNHVTlJbmh6T25OMGNtbHVaeUkrYkdGdWVtRnliMjVsUEM5ellXMXNNanBCZEhSeWFXSjFkR1ZXWVd4MVpUNDhMM05oYld3eU9rRjBkSEpwWW5WMFpUNDhjMkZ0YkRJNlFYUjBjbWxpZFhSbElFWnlhV1Z1Wkd4NVRtRnRaVDBpVUhKdmRtbHVZMmxoSUdScElHUnZiV2xqYVd4cGJ5SWdUbUZ0WlQwaWNISnZkbWx1WTJsaFJHOXRhV05wYkdsdklpQk9ZVzFsUm05eWJXRjBQU0oxY200NmIyRnphWE02Ym1GdFpYTTZkR002VTBGTlREb3lMakE2WVhSMGNtNWhiV1V0Wm05eWJXRjBPblZ5YVNJK1BITmhiV3d5T2tGMGRISnBZblYwWlZaaGJIVmxJSGh0Ykc1ek9uaHphVDBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01TOVlUVXhUWTJobGJXRXRhVzV6ZEdGdVkyVWlJSGh6YVRwMGVYQmxQU0o0Y3pwemRISnBibWNpUGtKUFBDOXpZVzFzTWpwQmRIUnlhV0oxZEdWV1lXeDFaVDQ4TDNOaGJXd3lPa0YwZEhKcFluVjBaVDQ4YzJGdGJESTZRWFIwY21saWRYUmxJRVp5YVdWdVpHeDVUbUZ0WlQwaVNXNWthWEpwZW5wdklHVXRiV0ZwYkNJZ1RtRnRaVDBpWlcxaGFXeEJaR1J5WlhOelVHVnljMjl1WVd4bElpQk9ZVzFsUm05eWJXRjBQU0oxY200NmIyRnphWE02Ym1GdFpYTTZkR002VTBGTlREb3lMakE2WVhSMGNtNWhiV1V0Wm05eWJXRjBPblZ5YVNJK1BITmhiV3d5T2tGMGRISnBZblYwWlZaaGJIVmxJSGh0Ykc1ek9uaHphVDBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01TOVlUVXhUWTJobGJXRXRhVzV6ZEdGdVkyVWlJSGh6YVRwMGVYQmxQU0o0Y3pwemRISnBibWNpUG5JdWJHRnVlbUZ5YjI1bFFIVnVhVzl1WlhaaGJHeHBaV1JsYkdsNmFXVXVabVV1YVhROEwzTmhiV3d5T2tGMGRISnBZblYwWlZaaGJIVmxQand2YzJGdGJESTZRWFIwY21saWRYUmxQanh6WVcxc01qcEJkSFJ5YVdKMWRHVWdSbkpwWlc1a2JIbE9ZVzFsUFNKSmJtUnBjbWw2ZW04Z1pHa2djbVZ6YVdSbGJucGhJaUJPWVcxbFBTSnBibVJwY21sNmVtOVNaWE5wWkdWdWVtRWlJRTVoYldWR2IzSnRZWFE5SW5WeWJqcHZZWE5wY3pwdVlXMWxjenAwWXpwVFFVMU1Pakl1TURwaGRIUnlibUZ0WlMxbWIzSnRZWFE2ZFhKcElqNDhjMkZ0YkRJNlFYUjBjbWxpZFhSbFZtRnNkV1VnZUcxc2JuTTZlSE5wUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXhMMWhOVEZOamFHVnRZUzFwYm5OMFlXNWpaU0lnZUhOcE9uUjVjR1U5SW5oek9uTjBjbWx1WnlJK1ZtbGhJRk5sYkhaaElEYzFMemc4TDNOaGJXd3lPa0YwZEhKcFluVjBaVlpoYkhWbFBqd3ZjMkZ0YkRJNlFYUjBjbWxpZFhSbFBqeHpZVzFzTWpwQmRIUnlhV0oxZEdVZ1JuSnBaVzVrYkhsT1lXMWxQU0pPYjIxbElpQk9ZVzFsUFNKdWIyMWxJaUJPWVcxbFJtOXliV0YwUFNKMWNtNDZiMkZ6YVhNNmJtRnRaWE02ZEdNNlUwRk5URG95TGpBNllYUjBjbTVoYldVdFptOXliV0YwT25WeWFTSStQSE5oYld3eU9rRjBkSEpwWW5WMFpWWmhiSFZsSUhodGJHNXpPbmh6YVQwaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNUzlZVFV4VFkyaGxiV0V0YVc1emRHRnVZMlVpSUhoemFUcDBlWEJsUFNKNGN6cHpkSEpwYm1jaVBuSnZZbVZ5ZEc4OEwzTmhiV3d5T2tGMGRISnBZblYwWlZaaGJIVmxQand2YzJGdGJESTZRWFIwY21saWRYUmxQanh6WVcxc01qcEJkSFJ5YVdKMWRHVWdSbkpwWlc1a2JIbE9ZVzFsUFNKUVlYTnpkMjl5WkNCd2IyeHBZM2tpSUU1aGJXVTlJbkJ2YkdsamVVeGxkbVZzSWlCT1lXMWxSbTl5YldGMFBTSjFjbTQ2YjJGemFYTTZibUZ0WlhNNmRHTTZVMEZOVERveUxqQTZZWFIwY201aGJXVXRabTl5YldGME9uVnlhU0krUEhOaGJXd3lPa0YwZEhKcFluVjBaVlpoYkhWbElIaHRiRzV6T25oemFUMGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TVM5WVRVeFRZMmhsYldFdGFXNXpkR0Z1WTJVaUlIaHphVHAwZVhCbFBTSjRjenB6ZEhKcGJtY2lQa0ZzZEc4OEwzTmhiV3d5T2tGMGRISnBZblYwWlZaaGJIVmxQand2YzJGdGJESTZRWFIwY21saWRYUmxQanh6WVcxc01qcEJkSFJ5YVdKMWRHVWdSbkpwWlc1a2JIbE9ZVzFsUFNKVGRHRjBieUJrYVNCa2IyMXBZMmxzYVc4aUlFNWhiV1U5SW5OMFlYUnZSRzl0YVdOcGJHbHZJaUJPWVcxbFJtOXliV0YwUFNKMWNtNDZiMkZ6YVhNNmJtRnRaWE02ZEdNNlUwRk5URG95TGpBNllYUjBjbTVoYldVdFptOXliV0YwT25WeWFTSStQSE5oYld3eU9rRjBkSEpwWW5WMFpWWmhiSFZsSUhodGJHNXpPbmh6YVQwaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNUzlZVFV4VFkyaGxiV0V0YVc1emRHRnVZMlVpSUhoemFUcDBlWEJsUFNKNGN6cHpkSEpwYm1jaVBrbFVRVXhKUVR3dmMyRnRiREk2UVhSMGNtbGlkWFJsVm1Gc2RXVStQQzl6WVcxc01qcEJkSFJ5YVdKMWRHVStQSE5oYld3eU9rRjBkSEpwWW5WMFpTQkdjbWxsYm1Sc2VVNWhiV1U5SWtOdmJYVnVaU0JrYVNCa2IyMXBZMmxzYVc4aUlFNWhiV1U5SW1OcGRIUmhSRzl0YVdOcGJHbHZJaUJPWVcxbFJtOXliV0YwUFNKMWNtNDZiMkZ6YVhNNmJtRnRaWE02ZEdNNlUwRk5URG95TGpBNllYUjBjbTVoYldVdFptOXliV0YwT25WeWFTSStQSE5oYld3eU9rRjBkSEpwWW5WMFpWWmhiSFZsSUhodGJHNXpPbmh6YVQwaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNUzlZVFV4VFkyaGxiV0V0YVc1emRHRnVZMlVpSUhoemFUcDBlWEJsUFNKNGN6cHpkSEpwYm1jaVBrMVBURWxPUlV4TVFUd3ZjMkZ0YkRJNlFYUjBjbWxpZFhSbFZtRnNkV1UrUEM5ellXMXNNanBCZEhSeWFXSjFkR1UrUEhOaGJXd3lPa0YwZEhKcFluVjBaU0JHY21sbGJtUnNlVTVoYldVOUlsUnBjRzlzYjJkcFlTQmthU0J5YVdOdmJtOXpZMmx0Wlc1MGJ5QndaWElnZEhKMWMzUWdiR1YyWld3Z1lXeDBieUlnVG1GdFpUMGlhV1JsYm5ScFptbGpZWFJwYjI1VWVYQmxJajQ4YzJGdGJESTZRWFIwY21saWRYUmxWbUZzZFdVZ2VHMXNibk02ZUhOcFBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF4TDFoTlRGTmphR1Z0WVMxcGJuTjBZVzVqWlNJZ2VITnBPblI1Y0dVOUluaHpPbk4wY21sdVp5SStjMjFoY25SallYSmtQQzl6WVcxc01qcEJkSFJ5YVdKMWRHVldZV3gxWlQ0OEwzTmhiV3d5T2tGMGRISnBZblYwWlQ0OEwzTmhiV3d5T2tGMGRISnBZblYwWlZOMFlYUmxiV1Z1ZEQ0OEwzTmhiV3d5T2tGemMyVnlkR2x2Ymo0PTwvc2FtbDI6QXR0cmlidXRlVmFsdWU+PC9zYW1sMjpBdHRyaWJ1dGU+PC9zYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PC9zYW1sMjpBc3NlcnRpb24+PC9zYW1sMjpBZHZpY2U+PHNhbWwyOkF1dGhuU3RhdGVtZW50IEF1dGhuSW5zdGFudD0iMjAxNy0wOS0xM1QxMjo0NTo1MC41NjFaIj48c2FtbDI6QXV0aG5Db250ZXh0PjxzYW1sMjpBdXRobkNvbnRleHRDbGFzc1JlZj51cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YWM6Y2xhc3NlczpTZWN1cmVSZW1vdGVQYXNzd29yZDwvc2FtbDI6QXV0aG5Db250ZXh0Q2xhc3NSZWY+PHNhbWwyOkF1dGhlbnRpY2F0aW5nQXV0aG9yaXR5Pmh0dHBzOi8vZmVkZXJhLmxlcGlkYS5pdC9pZHAvcHJvZmlsZS9NZXRhZGF0YS9jb211bmUuYXJnZW50YS5mZS5pdC8zPC9zYW1sMjpBdXRoZW50aWNhdGluZ0F1dGhvcml0eT48L3NhbWwyOkF1dGhuQ29udGV4dD48L3NhbWwyOkF1dGhuU3RhdGVtZW50PjxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PHNhbWwyOkF0dHJpYnV0ZSBGcmllbmRseU5hbWU9Ik1ldG9kbyBkaSBhdXRlbnRpY2F6aW9uZSIgTmFtZT0iYXV0aGVudGljYXRpb25NZXRob2QiPjxzYW1sMjpBdHRyaWJ1dGVWYWx1ZSB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4c2k6dHlwZT0ieHM6c3RyaW5nIj5vdHA8L3NhbWwyOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDI6QXR0cmlidXRlPjxzYW1sMjpBdHRyaWJ1dGUgRnJpZW5kbHlOYW1lPSJQYXNzd29yZCBwb2xpY3kiIE5hbWU9InBvbGljeUxldmVsIj48c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzOnN0cmluZyI+QWx0bzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+PC9zYW1sMjpBdHRyaWJ1dGU+PHNhbWwyOkF0dHJpYnV0ZSBGcmllbmRseU5hbWU9IlVzZXIgaWRlbnRpdHkgdHJ1c3QgbGV2ZWwiIE5hbWU9InRydXN0TGV2ZWwiPjxzYW1sMjpBdHRyaWJ1dGVWYWx1ZSB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4c2k6dHlwZT0ieHM6c3RyaW5nIj5BbHRvPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT48L3NhbWwyOkF0dHJpYnV0ZT48c2FtbDI6QXR0cmlidXRlIEZyaWVuZGx5TmFtZT0iQ29kaWNlIEZpc2NhbGUiIE5hbWU9IkNvZGljZUZpc2NhbGUiPjxzYW1sMjpBdHRyaWJ1dGVWYWx1ZSB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4c2k6dHlwZT0ieHM6c3RyaW5nIj5MTlpSUlQ2NkUwNkIyNDlFPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT48L3NhbWwyOkF0dHJpYnV0ZT48c2FtbDI6QXR0cmlidXRlIEZyaWVuZGx5TmFtZT0iR2VzdG9yZSBkaSBjcmVkZW56aWFsaSIgTmFtZT0iYXV0aGVudGljYXRpbmdBdXRob3JpdHkiPjxzYW1sMjpBdHRyaWJ1dGVWYWx1ZSB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4c2k6dHlwZT0ieHM6c3RyaW5nIj5Db211bmUgZGkgQXJnZW50YTwvc2FtbDI6QXR0cmlidXRlVmFsdWU+PC9zYW1sMjpBdHRyaWJ1dGU+PC9zYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PC9zYW1sMjpBc3NlcnRpb24+PC9zYW1sMnA6UmVzcG9uc2U+"
            
            if !saml_response.nil? 
                #read the settings
                settings = get_saml_settings
                #creo un oggetto response
                response = Federa::Saml::Response.new(saml_response)
                #assegno alla response i settaggi
                response.settings = settings
                #estraggo dal Base64 l'xml, forse servirà..
                saml_response_dec = Base64.decode64(saml_response)

                #controllo validità response, da finire
                errore_autenticazione "La response non è valida" unless response.is_valid?

                attributi_utente = response.attributes
                codice_fiscale = attributi_utente[:CodiceFiscale]

                unless codice_fiscale
                    Spider.logger.error "L'Idp di Federa non ha restituito un name_id valido"
                    errore_autenticazione "il sistema di autenticazione remoto non ha trovato l'utente"
                end
                codice_fiscale = codice_fiscale.strip
                codice_fiscale_maiuscolo = codice_fiscale.upcase
                utente_qs = UtenteFederaEmiliaRomagna.where{ |ut_fed| (ut_fed.chiave == codice_fiscale) | (ut_fed.chiave == codice_fiscale_maiuscolo) }
                utente_portale = nil
                creato = false
                #se presente un utente federa lo carico
                unless utente_qs.length == 0
                    utente = utente_qs[0]
                    utente_portale = utente.utente_portale
                    Spider.logger.debug "** Caricato utente portale #{utente_portale.codice_fiscale}"
                else
                    #creo utente federa
                    utente = UtenteFederaEmiliaRomagna.new(:chiave => codice_fiscale)
                    #potrebbe già esserci un utente portale con quel cf
                    utente_presente_qs = Portal::Utente.where{ |ut_portale| (ut_portale.codice_fiscale == codice_fiscale) | (ut_portale.codice_fiscale == codice_fiscale_maiuscolo) }
                    unless utente_presente_qs.length == 0
                        #utente portale presente
                        utente_portale = utente_presente_qs[0]
                        Spider.logger.debug "** Creato utente federa collegato ad utente portale #{utente_portale.codice_fiscale}"
                    else
                        #devo creare un nuovo utente portale
                        utente_portale = Portal::Utente.new
                        creato = true
                    end
                end
                dati_da_idp = []
                #aggiorno i dati anagrafici
                unless attributi_utente[:nome].blank?
                    utente_portale.nome = attributi_utente[:nome] 
                    dati_da_idp << "Nome"
                end
                unless attributi_utente[:cognome].blank?
                    utente_portale.cognome = attributi_utente[:cognome]
                    dati_da_idp << "Cognome"
                end
                unless attributi_utente[:CodiceFiscale].blank?
                    utente_portale.codice_fiscale = attributi_utente[:CodiceFiscale]
                    dati_da_idp << "Codice Fiscale"
                end
                unless attributi_utente[:sesso].blank?
                    utente_portale.sesso = attributi_utente[:sesso]
                    dati_da_idp << "Sesso"
                end 
                

                if attributi_utente[:spidCode].blank?
                    unless attributi_utente[:luogoNascita].blank?
                        utente_portale.comune_nascita = attributi_utente[:luogoNascita]
                        dati_da_idp << "Comune Nascita"
                    end
                end
                stato_nascita = attributi_utente[:statoNascita]
                unless stato_nascita.blank?
                    dati_da_idp << "Stato Nascita"
                    if stato_nascita.strip == 'ITALIA' || stato_nascita.strip == '0'
                        utente_portale.stato_nascita = 'IT'
                    else
                        utente_portale.stato_nascita = stato_nascita
                    end
                end

                spid_code =  attributi_utente[:spidCode]
                unless spid_code.blank?
                    unless attributi_utente[:dataNascita].blank?
                        utente_portale.data_nascita = Date.strptime(attributi_utente[:dataNascita], "%Y-%m-%d")
                        dati_da_idp << "Data Nascita"
                    end
                else
                    unless attributi_utente[:dataNascita].blank?
                        utente_portale.data_nascita = Date.strptime(attributi_utente[:dataNascita], "%d/%m/%Y")
                        dati_da_idp << "Data Nascita"
                    end
                end
                email_pec =  attributi_utente[:emailAddress]
                unless email_pec.blank?
                    dati_da_idp << "Pec"
                    unless email_pec == '-'
                        utente_portale.pec = attributi_utente[:emailAddress] unless attributi_utente[:emailAddress].blank?
                    end
                end
                unless attributi_utente[:emailAddressPersonale].blank?
                    utente_portale.email = attributi_utente[:emailAddressPersonale]
                    dati_da_idp << "E-mail"
                end
                unless attributi_utente[:provinciaNascita].blank?
                    utente_portale.provincia_nascita = attributi_utente[:provinciaNascita]
                    dati_da_idp << "Provincia Nascita"
                end
                if utente_portale.cellulare.blank? && !attributi_utente[:cellulare].blank?
                    cellulare = attributi_utente[:cellulare]
                    dati_da_idp << "Cellulare"
                    if !cellulare.include?("+") && (cellulare.length == 10 || cellulare.length == 9)
                        utente_portale.cellulare = cellulare
                    elsif cellulare.include?("+39") && (cellulare.length == 13 || cellulare.length == 12)
                        utente_portale.cellulare = cellulare.gsub("+39","")
                    end
                end
                unless attributi_utente[:capResidenza].blank?
                    utente_portale.cap_residenza = attributi_utente[:capResidenza]
                    dati_da_idp << "Cap Residenza"
                end 
                unless attributi_utente[:comuneResidenza].blank?
                    utente_portale.comune_residenza = attributi_utente[:comuneResidenza]
                    dati_da_idp << "Comune Residenza"
                end
                unless attributi_utente[:indirizzoResidenza].blank?
                    utente_portale.indirizzo_residenza = attributi_utente[:indirizzoResidenza]
                    dati_da_idp << "Indirizzo Residenza"
                end
                unless attributi_utente[:provinciaDomicilio].blank?
                    utente_portale.provincia_residenza = attributi_utente[:provinciaDomicilio]
                    dati_da_idp << "Provincia Residenza"
                end
                unless attributi_utente[:telefono].blank?
                    utente_portale.telefono = attributi_utente[:telefono]
                    dati_da_idp << "Telefono"
                end 
                #salvo in sessione i dati che arrivano da idp
                @request.session['dati_da_idp'] = dati_da_idp

                utente_portale.stato = 'confermato'
                utente_portale.save

                authn_req_id = response.response_to_id
                unless authn_req_id.blank?
                    traccia_response = Portal::TracciaturaFederaEmiliaRomagna.load(:authn_req_id => authn_req_id)
                    unless traccia_response.blank?
                        saml_response_dec_compressa = Zlib::Deflate.deflate(saml_response_dec)
                        traccia_response.response = Base64.strict_encode64(saml_response_dec_compressa)
                        traccia_response.response_id = response.id
                        traccia_response.response_issue_instant = response.issue_instant
                        traccia_response.response_issuer = response.issuer
                        traccia_response.assertion_id = response.assertion_id
                        traccia_response.assertion_subject = response.assertion_subject
                        traccia_response.assertion_subject_name_qualifier = response.assertion_subject_name_qualifier
                        traccia_response.spid_code = attributi_utente[:spidCode]
                        traccia_response.authn_authority = attributi_utente[:authenticatingAuthority]
                        traccia_response.authn_method = attributi_utente[:authenticationMethod]
                        traccia_response.utente_tracciato = utente_portale
                        traccia_response.save
                    else
                        raise "Response non corrispondente ad una request effettuata"
                    end
                else
                    raise "Response senza id request"
                end


                if creato
                    #Spider.logger.debug "** CREATO TRUE"
                    utente.utente_portale = utente_portale
                    utente.utente_esterno.insert
                    utente.insert
                else
                    #Spider.logger.debug "** CREATO FALSE"
                    utente.utente_portale = utente_portale
                    utente.save
                end
                

                if (!@request.utente_portale || @request.utente_portale != utente_portale)
                    @request.utente_portale = utente_portale
                end
                # Spider.logger.debug("Utente portale: #{@request.utente_portale}")
                @request.utente_portale.authenticated(:federa_emilia_romagna)
                utente.save_to_session(@request.session)
                #@request.utente_portale.save_to_session(@request.session)
                if creato
                    email_amministratore_utente_registrato(utente_portale.id) unless utente_portale.email.blank?
                    #VIENE IMPOSTATO A CONFERMATO SEMPRE, mod del 27/09/2016
                    # if (attivazione_automatica)
                    #     #mando mail
                    #     email_amministratore_utente_registrato(utente_portale.id) unless utente_portale.email.blank?
                    # else
                    #     #mando mail
                    #     email_amministratore_attesa_conferma(utente_portale.id) unless utente_portale.email.blank?
                    #     @scene.utente = utente_portale
                    #     render('auth_providers/federa_emilia_romagna/attesa_attivazione')
                    #     done
                    # end
                end

                

                #controllo se vengono passati i campi obbligatori
                campi_obbligatori_presenti = Portal.controlla_campi_obbligatori(utente_portale)
                if campi_obbligatori_presenti
                    redirect Portal.http_s_url
                else
                    #lo rimando alla pagina di modifica dei dati
                    redirect Portal.http_s_url('dettagli_utente?modifica')
                end

            else
                errore_autenticazione "Non sono stati ricevuti dati per l'utente"
            end    
        end
        
        __.xml
        def logout_service
            #controllo indirizzo dell' identity provider e faccio logout
            settings = get_saml_settings
            # LogoutRequest accepts plain browser requests w/o paramters 
            logout_request = Federa::Saml::LogoutRequest.new( :settings => settings )

            # Since we created a new SAML request, save the transaction_id 
            # in the session to compare it with the response we get back.
            # You'll need a shared session storage in a clustered environment.
            @request.session[:transaction_id] = logout_request.transaction_id

            # Create a new LogoutRequest for this session Name ID
            request_content = logout_request.create( :name_id => "fabiano", :session_index => "indice_sessione" )
            redirect request_content
            #$out << request_content

                
        end


        __.html
        def errore_autenticazione(messaggio)
            @scene.messaggio_errore = messaggio
            Spider.logger.error("Errore autenticazione Federa: #{messaggio}")
            render 'auth_providers/federa_emilia_romagna/autenticazione_fallita'
            done
        end
        

        def get_saml_settings
            settings = Federa::Saml::Settings.new
            if Spider.conf.get('portal.federa.https_server')
                local_portal_url = Portal.http_s_url
            else
                local_portal_url = Portal.http_s_url
            end

            settings.assertion_consumer_service_url     = local_portal_url+'/auth/federa_emilia_romagna/assertion_consumer'
            settings.issuer                             = local_portal_url+'/auth/federa_emilia_romagna/sp_metadata'
            settings.sp_cert                            = File.join(Spider.paths[:certs],"default/cert.pem")
            settings.single_logout_service_url          = local_portal_url + '/auth/federa_emilia_romagna/logout_service'
            settings.sp_name_qualifier                  = local_portal_url + Spider.conf.get('portal.federa.sp_name_qualifier') 
            settings.idp_name_qualifier                 = Spider.conf.get('portal.federa.name_identifier_format')
            # Optional for most SAML IdPs
            #settings.authn_context = "urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport"
            #assegno ai settings un array da configurazione
            settings.name_identifier_format             = Spider.conf.get('portal.federa.name_identifier_format')
            settings.destination_service_url            = Spider.conf.get('portal.federa.destination_service_url')
            settings.single_logout_destination          = Spider.conf.get('portal.federa.single_logout_destination')
            settings.authn_context                      = Spider.conf.get('portal.federa.authn_context')
            settings.requester_identificator            = Spider.conf.get('portal.federa.requester_identificator')
            settings.skip_validation                    = Spider.conf.get('portal.federa.skip_validation')
            settings.idp_sso_target_url                 = Spider.conf.get('portal.federa.idp_sso_target_url')
            settings.idp_metadata                       = Spider.conf.get('portal.federa.idp_metadata')
            settings
        end

        def get_signature(relayState, request, sigAlg)
            #url encode relayState
            relayState_encoded = escape(relayState)
            #deflate e base64 della samlrequest
            deflate_request_B64 = encode(deflate(request))
            #url encode della samlrequest
            deflate_request_B64_encoded = escape(deflate_request_B64)
            #url encode della sigAlg
            sigAlg_encoded = escape(sigAlg)
            #querystring="RelayState=#{relayState_encoded}&SAMLRequest=#{deflate_request_B64_encoded}&SigAlg=#{sigAlg_encoded}"
            querystring="SAMLRequest=#{deflate_request_B64_encoded}&RelayState=#{relayState_encoded}&SigAlg=#{sigAlg_encoded}"
            #puts "**QUERYSTRING** = "+querystring
            digest = OpenSSL::Digest::SHA1.new(querystring.strip)  
            pk = OpenSSL::PKey::RSA.new File.read(File.join(Spider.paths[:certs],"default/private/key.pem"))
            qssigned = pk.sign(digest,querystring.strip)
            Base64.encode64(qssigned).gsub(/\n/, "")
        end

        
        def email_amministratore_attesa_conferma(id_utente)
            scene = Spider::Scene.new
            scene.utente = Portal::Utente.new(id_utente)
            scene.link_amministrazione = "http://#{@request.http_host}/admin/portal/utenti_federa_emilia_romagna/#{scene.utente.utente_federa_emilia_romagna.id}"
            scene.auth_provider = 'Gestore Identità Federa Emilia Romagna'
            headers = {'Subject' => "Registrazione al portale"}
            send_email('amministratore/utente_attesa_conferma', scene, Spider.conf.get('portal.email_from'), Spider.conf.get('portal.email_amministratore'), headers)
        end
        
        def email_amministratore_utente_registrato(id_utente)
            scene = Spider::Scene.new
            scene.utente = Portal::Utente.new(id_utente)
            scene.link_amministrazione = "http://#{@request.http_host}/admin/portal/utenti_federa_emilia_romagna/#{scene.utente.utente_federa_emilia_romagna.id}"
            scene.auth_provider = 'Gestore Identità Federa Emilia Romagna'
            headers = {'Subject' => "Registrazione al portale"}
            send_email('amministratore/utente_registrato', scene, Spider.conf.get('portal.email_from'), Spider.conf.get('portal.email_amministratore'), headers)
        end
        
       
        
    end
    
end
